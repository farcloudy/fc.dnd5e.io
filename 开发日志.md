# 战斗流程
0. 如果是第一回合，获得初始气势
1. 进入回合
    1. 抽卡->抽卡数量，存卡上限
    2. 选择不同的招式卡，发动攻击














<!---
项目思路
卡牌构建式的武侠游戏

1. 核心是“**攻击**”牌。**攻击**的效果受到属性影响（力量，武器）
2. 距离：通过移动拉近与敌人的距离。根据兵器的不同，能够发动攻击的距离也不同。
3. 连击与回合：在敌人的回合积攒“势”，在自己的回合，攻击消耗“势”。势消耗完后进入敌人的回合。
4. 格挡与闪避：
5. 流派与招式：自走棋？
6. 属性：

|一级属性|二级属性||一级属性|二级属性|
|:--:|:--:|:--:|:--:|:--:|
|力量|基础伤害||智力|悟性|
||暴击倍率||感知|闪避率|
||格挡减伤|||暴击率|
||移动速度|||格挡率|
|敏捷|出手速度|||状态抵抗|
||闪避率||魅力|气质系统|
||格挡率||
||暴击率||
|体质|生命上限||
||状态抵抗||

7. 内功与内力？
8. 等级？技能点？熟练度？
9. 气质：外向<>内向；观察<>直觉；理性<>敏感；规划<>机会

气质与武功类型是对应的

外向E<>内向I：
造势与借势。前者主动进攻，强调先手、自己回合；后者强调后手、敌方回合

观察与直觉：
观察型S：前半阶段试探，闪避、格挡、命中、威力都越打越强
直觉型N：起手猛攻，直觉与格挡自保

逻辑T与情感F
逻辑：不易受到状态影响，稳定
情感：鼓舞与沮丧，士气影响大


判断J与展望P

判断型的武功，应对周全，能够更好地化解敌人的攻势；

展望型的武功，羚羊挂角，让敌人无从应对；

战斗阶段：
1. 双方决定先后手
    - 切磋：可以自行决定（根据人物性格）
    - 遭遇战：根据敏捷属性，走时间条
2. 起势
    - 势的数量决定了一回合里能够攻击的次数
        - 相同等级的武功，势×单次伤害的积是一定的
        - N型武功：先手第一回合势加成
        - 战斗拖延越久，每回合的势越少（存疑，内力已经消耗，这里是否重复）
3. 进攻
    - 有多种进攻方式，对应不同的防御方式（剪刀石头布）
    - 逼迫：难以格挡，易于闪避，意在拉开与敌人的距离
        - 短兵可以使用“欺身”，拉近距离
    - 横扫：难以闪避，易于格挡，想要以此来打破防御/架势
    - 攻击：对闪避和格挡的难度没有变化
4. 试探
    - 通过一两个回合的交手，可以估计敌人的属性（闪避，格挡，力量）
    - 一次攻击投入的气势/内力越多，招式威力越大；但被闪避/格挡后，敌人反击的成功率越高；
5. 防御
    - 在防御阶段，每一次成功的闪避、格挡，都会积攒气势；
    - 每一次闪避，都会迫使远离敌方。短兵武学可以欺身。
    - 格挡能够架住敌人的攻击。有一个格挡值，如果敌人的威力超过格挡值，首先受到超额部分伤害，然后进行力量判定，失败则被打飞武器。
        - 卸力：一些武学可以使用卸力，提供极高的格挡值
    - 架势：架势是闪避或格挡失败的容错率。如果闪避或格挡失败后受到了过高的伤害，那么架势被击破，角色需要花费一整个回合来重整架势；（HP）
    - 反击：闪避或格挡成功后，也可以选择反击。如果反击成功，即刻进入自己的回合；如果反击失败，对方的下一次攻击视为“破绽”，只要命中就能破坏所有架势。
6. 特性
    - 破绽：失败的反击会暴露破绽。除此之外，部分武学也可以主动发现敌人的破绽
    - 破竹：一次性造成超过架势两倍的伤害，能够直接斩首敌人；超过1.5倍，敌人需进行内伤昏迷判定。
    - 乘胜：一些武学在造成伤害后可以恢复气势；
    - 浴血：一些武学在受到伤害后可以恢复气势（架势值更高）；
    - 金刚：一些武学可以抵消受到的伤害；
    - 卸力：一些武学牺牲闪避来强化格挡，
    - 快慢：每一攻击过后，都会随机获得对闪避/格挡难度的增益，影响敌人判断。
    - 士气：一回合内越战越勇（会让敌人积攒更多气势）|急躁：防御阶段的错误会带来减益


# 武功与卡牌
1. 攻击卡牌（平A）
    - 属性：威力；距离；命中；反格挡；闪避；格挡；暴击率；暴击伤害；攻击速度
    - 随武器变换，角色自带[3]张攻击卡牌；
    - 拳掌：
    - 剑
    - 刀
    - 枪
    - 棍
    - 指
2. （外功）招式卡牌：
    - 是特殊的攻击，与武器类型绑定。
    - 招式有4*2=8种类型；多个同类的招式可以组合成套装；套装有额外的被动效果；
    - 招式需要消耗内力；
3.  内功
    - 内功提供被动属性；
    - 部分内功带有一个内功招式；
4.  轻功，闪避与格挡：反应动作（陷阱卡）
    - 在自己的回合，覆盖任意张闪避与格挡；在敌方回合受到攻击时发动；
    - 角色会优先使用成功率更高的动作（闪避/格挡），也可以在自己回合指定；
5.  假动作与反击
    - 如果闪避/格挡成功，可以发动反击
    - 每一次都要选？只有roll点差异达到一定水平才激活反击
    - 反击成功，那么直接进入自己的回合
    - 假动作？如果反击的对象是假动作牌，那么受到伤害
    

# 攻击函数
```javascript
function attack(actor, moves, enemy){
    // 根据敌人反应判断是否造成伤害
    if (enemy.破绽){
        // 击中
    }
    else if (enemy.指定反应 = 闪避) & (enemy.准备闪避 > 1){
        enemy.准备闪避 -= 1;
        // 计算命中率
        if 命中(actor.moves.命中(), enemy.闪避){
            伤害(actor.moves.伤害, enemy);
        }
        else{}; // 未命中
    }
    else if (enemy.指定反应 = 格挡) & (enemy.准备格挡 > 1){
        enemy.准备格挡 -= 1;
        // 计算格挡成功
        if 格挡(actor.moves.破防(), enemy.格挡){
            伤害(actor.moves.伤害, enemy, 格挡);
        }
        else{}; // 未命中
    }
    // 决定后续结果
    if (命中){
        // 计算造成的伤害
        var 伤害 = ;
        // 判断伤害结果
        if (enemy.破绽){
            enemy.HP -= 伤害;
            if (enemy.HP < 1){
                获胜
            }
        }
        else if (伤害 >= enemy.架势 + enemy.HP){
            获胜
        }
        else if (伤害 >= enemy.架势){
            enemy.架势 = 0;
            enemy.破绽 = true;
        }
        else {
            enemy.架势 -= 伤害
        }
    }
    // 决定战斗结果
    if (敌人死亡|获胜){
        return ?;
    }
    else {
        气势 - actor.moves.气势;
    }
}
```


    
